<!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 10-07-2565 ‡πÄ‡∏ß‡∏•‡∏≤ 15.30 ‡∏ô. -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous">
  </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
  <script src="https://api.longdo.com/map/?key=43c7e160bf5a19869fafa7afdbfec9c5"></script>

  <!-- code ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö select2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.1.1/dist/select2-bootstrap-5-theme.min.css" />

  <title>REGISTER</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #f5f5f5;
      width: 100vw;
      min-height: 100vh;
      /* display: flex;
            justify-content: center;
            align-items: center; */
      font-family: 'Prompt', sans-serif;
      background: #e3cccc;


    }

    .container {
      max-width: 800px;
    }

    .form-control {
      border-radius: 20px;
    }

    .form-control:focus {
      border-color: #e3cccc;
      box-shadow: 0 0 0 0.2rem rgba(227, 204, 204, 0.25);
      background-color: #E24b4b;
      color: #ffffff;

    }



    .display-5 {
      color: #d72323;
    }

    .btn-custom {
      /* background-color: #d72323; */
      /* color: #ffffff; */
      min-width: 200px;
      border-color: #d72323;
      border-radius: 20px;
    }

    .btn-custom:hover {
      background-color: #d72323;
      color: #ffffff;
      /* min-width: 200px;
            border-color: #d72323;
            border-radius: 20px; */
    }

    #map {
      width: 100%;
      height: 100%;
      min-height: 400px;
      max-height: 100vw;
    }

    /* .navbar{
            background-color: #F2C94C;
        } */
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="./icon-removebg-preview.png" alt="" width="50" class="d-inline-block align-text-top">&nbsp;AnyQuest</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
      <div class="collapse navbar-collapse ms-auto" id="navbarSupportedContent">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="./register.html">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
          </li>

        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <form class="bg-white p-4 border shadow rounded-3 needs-validation d-none" novalidate>

      <div class="row justify-content-center my-3">
        <div class="display-5 fw-bold">Work Request</div>
      </div>

      <div class="row justify-content-start g-3">
        <div class="col-md-6">
          <label for="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
          <input type="text" class="form-control" id="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" name="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required>
        </div>
        <div class="col-md-6">
          <label for="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ</label>
          <input type="text" class="form-control" id="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" name="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required>
        </div>
        <div class="col-md-6">
          <label for="‡∏≠‡∏≤‡∏¢‡∏∏">‡∏≠‡∏≤‡∏¢‡∏∏</label>
          <input type="text" class="form-control" id="‡∏≠‡∏≤‡∏¢‡∏∏" name="‡∏≠‡∏≤‡∏¢‡∏∏" required>
        </div>
        <div class="col-md-6">
          <label for="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
          <input type="text" class="form-control" id="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û" name="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û" required>
        </div>
        <div class="col-md-6">
            <label for="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</label>
            <input type="text" class="form-control" id="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ" name="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ" required>
        </div>

        <!-- <div class="col-md-6">
          <label class="form-label">‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ *</label>
          <select class="form-select" id="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ" name="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ" required>
                        <option disabled selected value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</option>
                        <? var list = SpreadsheetApp.openById('1lTGua4jRMQpW6LAxHuwsmwks2aKut4lM7vQa3akJAgU').getSheetByName('Data List').getRange('A:A').getDisplayValues() ?>
                        <? list = [...new Set(list.map(r=> r[0]).slice(1))].filter(r => r!= '') ?>
                        <? list.forEach(datalist =>{ ?>
                        <option value="<?= datalist ?>">
                            <?= datalist ?>
                        </option>
                        <? }) ?>
                    </select>
        </div> -->

        <div class="col-md-6">
          <label for="Code">‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
          <input type="text" class="form-control" id="Code" name="Code" required>
        </div>

        <div class="col-md-12">
          <label for="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</label>
          <textarea class="form-control" id="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô" name="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô" rows="5" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" required></textarea>
        </div>

        <div class="col-md-6">
          <label for="‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡πÑ‡∏ü‡∏•‡πå)</label>
          <input type="file" accept="image/*" multiple class="form-control" id="‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå" name="‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå" required>
        </div>

        <div class="col-md-12 d-none">
          <div class="row justify-content-center" id="preview"></div>
        </div>

        <div class="col-md-6">
          <label for="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</label>
          <input type="number" min="20" max="3000" class="form-control" id="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á" name="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á" placeholder="‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 20 - 3,000 ‡∏ö‡∏≤‡∏ó" required>
        </div>

        <div class="col-md-12">
          <label for="Location">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (Location)</label>
          <input type="text" class="form-control" id="Location" name="Location" required>
          <input type="text" class="form-control" id="Geolocation" name="Geolocation" hidden>
        </div>

        <div class="col-md-12">
          <div id="map" class="rounded"></div>
        </div>

        <div class="col-md-12">
          <label for="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
          <textarea class="form-control" id="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" name="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" rows="2" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏ã‡∏≠‡∏¢/‡∏ï‡∏∂‡∏Å/‡∏ä‡∏±‡πâ‡∏ô/‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï"></textarea>
        </div>

        <div class="col-md-12">
          <label for="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <input class="form-control" id="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" name="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
        </div>

        <div class="col-md-6">
          ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:&nbsp;&nbsp;<h4><span class="badge" id="Status_span" name="Status_span"></span></h4>
          <input class="form-control" type="text" name="Status" id="Status" value="" hidden>
        </div>

        <div class="col-md-12">
          <div class="form-check fw-bold">
            <input class="form-check-input" type="checkbox" value="‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î" id="discount" name="discount">
            <label class="form-check-label" for="discount">‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
          </div>
        </div>

      </div>
      <div class="row mt-4">
        <div class="col text-center">
          <button type="submit" class="btn btn-custom">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </div>
      
    </form>
  </div>
  <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
  <script>
    // VConsole will be exported to `window.VConsole` by default.
        // var vConsole = new window.VConsole();
  </script>
  <script>
    const scripturl = 'https://script.google.com/macros/s/AKfycbwjm6auKkX0HzUYc54_Fzz7AgXotCftNBcCCS9cQU1V6kZQ-e-ep4nyT1E-vJ_ylD4l/exec'
        const scripturl_request = 'https://script.google.com/macros/s/AKfycbz96KVstG87T2HHcFfLqYcYbycoxN5yv-9dZkwMjjK8cFdiP6F1rgkXAVn4qWgprXel/exec'        
        var foldertoken
        $(document).ready(function () {
            navigator.geolocation
            Swal.fire({
                icon: 'info',
                title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ',
                text: '‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
                showDenyButton: true,
                denyButtonText: '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
                confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                input: 'text',
                inputAttributes: {
                    autocapitalize: 'off'
                },
                preConfirm: (num) => {
                    return num
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    login(result.value)
                } else if (result.isDenied) {
                    location.href = "./register.html"
                }
            })


            $('.form-control').each(function () {
                let label = $(this).parent().find('label').text();
                $(this).parent().append(` <div class="invalid-feedback">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà ${label}</div>`)
            })


            $('#‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå').change(function () {
                if ($(this)[0].files.length <= 0 || $(this)[0].files.length > 3) {
                    return Swal.fire({
                        icon: 'error',
                        title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÑ‡∏ü‡∏•‡πå',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        allowOutsideClick: false,
                    }).then((result) => {
                        if (result.isConfirmed) {
                            $('#‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå').val('')
                        }
                    })
                } else {
                    let files = []
                    let fileinput = document.getElementById('‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå').files
                    for (let i = 0; i < fileinput.length; i++) {
                        files.push(fileinput[i])
                    }

                    files.forEach(file => {
                        let reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onloadend = function (e) {
                            let img = document.createElement("img");
                            img.src = e.target.result;
                            $(img).addClass('img-fluid')
                            let div = document.createElement("div");
                            $(div).addClass('col-md-4')
                            $(div).append(img)
                            $('#preview').append(div)
                        }
                    })
                }

            })

        });

        function login(num) {
            $.LoadingOverlay("show");
            $.ajax({
                url: scripturl,
                dataType: 'json',
                method: 'post',
                data: {
                    opt: 'login',
                    num: num
                },
                success: function (result) {

                    $.LoadingOverlay("hide");
                    if (result.status == 'success') {

                        showData(result.data)
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                            text: result.status
                        }).then(() => {
                            location.reload()
                        })
                    }
                }
            })
        }

        function showData(data) {
            $('.d-none').removeClass('d-none')

            $('#‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•').val(data['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•']).prop('readonly', true)
            $('#‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå').val(data['‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå']).prop('readonly', true)
            $('#‡∏≠‡∏≤‡∏¢‡∏∏').val(data['‡∏≠‡∏≤‡∏¢‡∏∏']).prop('readonly', true)
            $('#‡∏≠‡∏≤‡∏ä‡∏µ‡∏û').val(data['‡∏≠‡∏≤‡∏ä‡∏µ‡∏û']).prop('readonly', true)
            $('#‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ').val(data['‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ']).prop('readonly', true)
            $('#Code').val(data['Code']).prop('readonly', true)
            $('#Status').val(data['Status']).prop('readonly', true)

            if (data['Status'] == 'Y') {
                $('#Status_span').addClass('text-bg-secondary').text('‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß')
                $('#discount').closest('.col-md-12').remove()
            } else if (data['Status'] == 'N') {
                $('#Status_span').addClass('text-bg-warning').text('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î')
            }
            getLocation()
            getFolderToken()
        }

        async function formsubmit() {
            event.preventDefault()
            let form = $('form')[0]
            let formdata = $(form).serializeArray()

            let ele = {}
            for (let i = 0; i < formdata.length; i++) {
                ele[formdata[i].name] = formdata[i].value
            }

            let filesupload = await uploadFiles()
            filesupload.forEach(function (item, index) {
                ele[`File${index + 1}`] = item
            })

            if (ele['discount'] == '‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î') {
                ele['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß'] = parseInt(ele['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á']) - 100
                if (ele['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß'] < 0) {
                    ele['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß'] = 0
                }
            } else {
                ele['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß'] = ele['‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á']
            }
            Swal.close()
            $.LoadingOverlay("show");
            $.ajax({
                url: scripturl_request + '?opt=saverequest',
                type: 'POST',
                data: ele,
                success: function (data) {
                    $.LoadingOverlay("hide");

                    if (data.status == "success") {
                        Swal.fire({
                            icon: 'success',
                            title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        }).then(() => {
                            window.location.href = "./index.html"
                        })
                    } else {
                        alert("‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
                    }
                }
            })
        }
  </script>
  <script>
    (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                        form.classList.add('was-validated')
                        $(form).find(":invalid").first().focus();
                    } else {
                        formsubmit()
                    }


                }, false)
            })
        })()
  </script>
  <script>
    var map;
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(initmap)
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }
        function initmap(geo) {
            console.log(geo)
            rerverseGeocoding(geo.coords.latitude, geo.coords.longitude)
            map = new longdo.Map({
                placeholder: document.getElementById('map'),
                language: 'th',
                zoom: 19,
            });
            map.Layers.setBase(longdo.Layers.NORMAL);
            map.Layers.add(longdo.Layers.POI);
            map.location(longdo.LocationMode.Geolocation);
            map.Event.bind('click', function () {
                var mouseLocation = map.location(longdo.LocationMode.Pointer);
                console.log("üöÄ ~ mouseLocation", mouseLocation)
                map.Overlays.add(new longdo.Marker(mouseLocation));
                rerverseGeocoding(mouseLocation.lat, mouseLocation.lon)
            });

            map.Event.bind('overlayClick', function (overlay) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà',
                    allowOutsideClick: false,
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '‡∏•‡∏ö',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                }).then(result => {
                    if (result.isConfirmed) {
                        map.Overlays.remove(overlay);
                    }
                })
            });
        }

        function rerverseGeocoding(lat, lon) {
            $.ajax({
                url: "https://api.longdo.com/map/services/address?",
                dataType: "jsonp",
                type: "GET",
                crossDomain: true,
                headers: {
                    "Access-Control-Allow-Origin": "*",
                    "Access-Control-Allow-Headers": "*",
                    "Access-Control-Allow-Methods": "*",
                },
                data: {
                    key: "43c7e160bf5a19869fafa7afdbfec9c5",
                    lon: lon,
                    lat: lat,
                },
                success: function (results) {
                    console.log("üöÄ ~ results", results)
                    $('#Location').val((results.road ? (results.road + ' ') : '') + results.subdistrict + " " + results.district + " " + results.province + " " + results.postcode + " " + results.country).prop('readonly', true)
                    $('#Geolocation').val(lat + "," + lon)
                    console.log("geo", $('#Geolocation').val());
                },
                error: function (response) {
                    console.log(response);
                }
            });
        }
  </script>
  <script>
    let firstfile = true

        function showUploadEnd(e) {
            Swal.fire({
                icon: 'success',
                title: '‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà<br><br><p class="text-danger">**‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<\p>',
            })
            return e.id
        }
        function dataURItoBlob(dataURI) {
            var byteString = atob(dataURI.split(',')[1]);
            var ab = new ArrayBuffer(byteString.length);
            var ia = new Uint8Array(ab);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: 'image/png' });
        }
        function getFolderToken() {
            $.ajax({
                url: scripturl,
                type: 'POST',
                data: {
                    name: $('#‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•').val(),
                    opt: 'getFolderToken'
                },
                success: function (data) {
                    foldertoken = data
                }
            })

        }
        async function uploadFiles() {
            var count
            const handleProgress = function (value) {
                if (value === 0) console.log("Uploading...");
                else {
                    console.log("Uploading... " + value * 100 + "%");
                }
                let percent = Math.round(value * 100)
                Swal.update({
                    title: "‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà " + count,
                    html: `<p class="text-danger">**‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<\p><div class="progress">
  <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar " style="width: ${percent}%;" aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100">${percent}%</div>
</div>`,
                    allowOutsideClick: false,
                    showConfirmButton: false
                })
                // Swal.showLoading(Swal.getConfirmButton())
            }
            Swal.fire({
                icon: 'info',
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå',
                html: 'uploading...<br><br><p class="text-danger">**‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<\p>',
                allowOutsideClick: false
            })
            let files = []
            let chunkSize = Math.round(0.75 * 1024 * 1024)
            let fileinput = document.getElementById('‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå').files
            for (let i = 0; i < fileinput.length; i++) {
                files.push(fileinput[i])
            }
            count = 1
            let now = new Date()
            let metadata = {
                name: $('#‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•').val() + "_1 " + now.toLocaleString('th-TH', {
                    hour12: false,
                    month: "numeric",
                    day: "numeric",
                    year: "numeric",
                    hour: "numeric",
                    minute: "numeric",
                    second: "numeric"
                })
            };
            let file = files[0]

            let res1 = await gdriveUpload({ ...foldertoken, file, metadata, chunkSize, onProgress: handleProgress })
            files[0] = res1.id

            if (files[1]) {
                count = 2
                metadata = {
                    name: $('#‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•').val() + "_2 " + now.toLocaleString('th-TH', {
                        hour12: false,
                        month: "numeric",
                        day: "numeric",
                        year: "numeric",
                        hour: "numeric",
                        minute: "numeric",
                        second: "numeric"
                    })
                };
                let file = files[1]
                let res2 = await gdriveUpload({ ...foldertoken, file, metadata, chunkSize, onProgress: handleProgress })
                files[1] = res2.id
            }
            if (files[2]) {
                count = 3
                metadata = {
                    name: $('#‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•').val() + "_3 " + now.toLocaleString('th-TH', {
                        hour12: false,
                        month: "numeric",
                        day: "numeric",
                        year: "numeric",
                        hour: "numeric",
                        minute: "numeric",
                        second: "numeric"
                    })
                };
                let file = files[2]
                let res3 = await gdriveUpload({ ...foldertoken, file, metadata, chunkSize, onProgress: handleProgress })
                files[2] = res3.id
            }


            return files.map(id => {
                return 'https://drive.google.com/uc?id=' + id
            })
        }

  </script>
  <script>
    async function gdriveUpload(opt) {
            if (!(opt.file && opt.token)) throw new TypeError("bad param");
            if (!opt.file.size) return new Error("empty file");
            let res
            try {
                const location = await getUploadLocation();
                if (location instanceof Error) return location;
                res = await uploadChunks(location);
                if (res instanceof Error) return res;
                return res;
            } catch (error) {
                if (error instanceof Error) return error;
                throw error;
            }
            async function getUploadLocation() {
                let metadata = { mimeType: opt.file.type, name: opt.file.name };
                if (opt.folder) metadata.parents = [opt.folder];
                if (opt.metadata) metadata = { ...metadata, ...opt.metadata };
                try {
                    const response = await fetch(
                        "https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable",
                        {
                            method: "POST", cache: "no-cache",
                            headers: {
                                Authorization: "Bearer " + opt.token,
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(metadata)
                        });
                    if (!response.ok) return new Error(`create: ${response.status} ${response.statusText}`);
                    const location = response.headers.get("location");
                    if (!location) return new Error("no location");
                    return location;
                } catch (error) {
                    if (error instanceof Error) return error;
                    throw error;
                }
            }
            async function uploadChunks(location) {
                const onProgress = opt.onProgress || ((_v) => { });
                const chunkSize = opt.chunkSize || _DEFAULT.chunkSize;
                if (chunkSize <= 0 || chunkSize % (256 * 1024))
                    throw TypeError("bad chunkSize: " + chunkSize);
                const size = opt.file.size;
                try {
                    for (let end = NaN, start = 0; ; start = end + 1) {
                        onProgress(start / size); // signal progress
                        end = Math.min(start + chunkSize, size);
                        const blob = await opt.file.slice(start, end).arrayBuffer(); // read from file
                        const response = await fetch(location, // upload the chunk to location
                            {
                                method: "PUT", cache: "no-cache", body: blob,
                                headers: { "Content-Range": `bytes ${start}-${end - 1}/${size}` }
                            });
                        if (response.ok) { // all done
                            onProgress(1); // signal 100% progress
                            return response.json(); // success
                        }
                        if (response.status != 308) return new Error(`upload: ${response.status} ${response.statusText}`);
                        const r = response.headers.get("Range");
                        if (!r) return new Error("no Range");
                        end = parseInt(r.substr(r.indexOf("-") + 1)); // get where the real upload end
                        if (!Number.isInteger(end) || end <= start) return new Error("bad range: " + r);
                    }
                } catch (error) {
                    if (error instanceof Error) return error;
                    throw error;
                }
            }
        }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    $(document).ready(function () {
            $("#fullname").select2({
                theme: "bootstrap-5",
                width: '100%',
                placeholder: "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á 3-4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£",
                allowClear: true
            });
        });
        $(document).ready(function () {
            $("#followTo").select2({
                theme: "bootstrap-5",
                width: '100%',
                placeholder: "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á 3-4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£",
                allowClear: true
            });
        });

  </script>
</body>

</html>
